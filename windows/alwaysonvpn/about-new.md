# Общее понимание о решении Always On VPN

**VPN** (**V**irtual **P**rivate **N**etwork) - наиболее распространенный способ организации безопасного удаленного доступа пользователям к корпоративным ресурсам за периметром корпоративной сети. А поскольку из года в год все больше сотрудников переходят на удаленный формат работы, перед компаниями стоит задача предоставить эффективный и безопасный удаленный доступ.

Данная обзорная статья посвещена технологии **Always On VPN** от Microsoft, которая появилась в **Windows 10** и является аналогом класического VPN со своими плюсами и минусами.


## Always On VPN замена DirectAccess

В качестве альтернативы VPN, Microsoft в Windows 7 и Windows Server 2008 R2 представила свою технологию удаленного доступа DirectAccess. 

Технология DirectAccess позволяет использовать безопасное подключение компьютеров сотрудников к корпоративной сети по протоколу HTTPS (TCP 443) без участия пользователя и установки дополнительных клиентов. Технология работает незаметно для пользователя и гарантирует, что клиентский компьютер всегда подключен к корпоративной сети при наличие интернета на компьютере. Тем самым дополнительно позволяет техническому персоналу управлять такими компьютерами, как если бы они находились в локальной сети.

Но есть и свои минусы данной технологии. В качестве операционной системы необходимо использовать только Enterprise-редакцию или Ultimate в Windows 7. Данное решение базируется на использовании протокола IPv6.

С выходом Windows 10 появилось еще одно решение по организации удаленного доступа сотрудникам к корпоративным ресурсам - это технология **Always On VPN**.

**Always On VPN** в **Windows 10** это следующий этап развития решения Microsoft для организации безопасного доступа клиентов к корпоративной сети удалено. **Always On VPN** призвано заменить **DirectAccess**.

С официальной документация по **Always On VPN** можно ознакомиться на [сайте Microsoft](https://docs.microsoft.com/en-us/windows-server/remote/remote-access/vpn/always-on-vpn/). На данном сайте представлен авторский вариант последовательности шагов по настройки Always On VPN основанный на опыте в коммерческих проектах.


## Общий принцип работы Always On VPN

**Always On VPN** - это технология только для **Windows 10**. Требуется **Windows 10 Anniversary Update** (версия **1607**) или новее. При этом можно использовать редакцию как Pro, так и Enterprise. К тому же в некоторых случаях можно не подключать компьютер к **Windows Server Active Directory**.

В качестве VPN сервера и RADIUS сервера можно использовать решения от других производителей. Но в данной статьи в качестве VPN сервера будет использоваться Windows Server с установленной ролью Routing and Remote Access, а в качестве RADIUS сервера будет использоваться Windows Server с установленной ролью Network Policy Server.

Устройство VPN, должен поддерживать маршрутизацию **IKEv2**, который с одной стороны является плюсом. **IKEv2** может автоматически восстанавливать соединение, если происходит прерывание сетевого соединения. Но в качестве недостатка **IKEv2** можно отнести то, что используются порты **UDP 500** и **UDP 4500**, которые могут быть закрыты на сетевом оборудовании, если пользователь со своим компьютером будет работать, например, в кафе или в номере гостиницы, где как правило доступны только порты **TCP 80** и **TCP 443**.

В качестве резервного протокола можно использовать **SSTP**, который использует **TCP 443**, по сути HTTPS-протокол, но такое соединение работает не очень хорошо и не подерживает **Device Tunnel**.

Чтобы понять общий принцип работы **Always On VPN**, обратимся к схеме Microsoft с описанием последовательностей, что происходит при подключении.

Схема инфраструктуры, которая необходима для развертывания Always On VPN.

![Общая схема Always On VPN](/../img/aovpn/aovpn-overview.jpg "Общая схема организации решения Always On VPN")
